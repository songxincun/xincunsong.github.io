---
layout: post
title:  "Lua 坑爹笔记"
date:   2014-08-19 19:46:49
categories: lua
---

1.  注释
    -- 开头为单行注释.
    --[[ ... ]]-- 为块注释.  

2.  语句分割
    可以用分号, 也可以什么都不用. 换行符更空格没有什么区别.
    建议是单行代码多语句之间用分号隔开.

3.  变量名
    跟 C 语言一样, 区分大小写, 不建议用下划线开头.

4.  变量声明
    动态类型语言, 直接给变量赋值即创建一个变量, 无须声明变量类型.
    直接使用一个未声明的变量也是可以的, 会得到值: nil.
    而删除一个变量的方法是将该变量赋 nil.

5.  命令行参数
    内置的全局变量 arg 保存了命令行参数.

6.  boolen 值
    false 和 nil 为否定值, 其他的所有都是肯定值 (包括 0 和空串).

7.  数值
    lua 没有整数类型, 只有浮点数类型.

8.  字符串
    可以用双引号或单引号括起来, 两者没有区别, 字符串值不可变.
    只能重构一个新的字符串.   
    支持类似 C 语言的那些基本的转义字符. 
    [[ ... ]] 支持跨行字符串 (类似于 Python 里的 """ ... """).
    [===[ 之间可以加入任意多的 = 号. 当然, ]===] 之间也必须加入同等的 = 号.
    块注释也是一样.

9.  字符串和数值自动转换 
    lua 里面的字符串和数值可以根据实际情况互相自动转换.
    '+' 用于数值加, 而 '..' 用于字符串加. 
    所以,

    ```lua
    "10" + 1        -- 返回 11 
    "10" .. 1       -- 返回 "101" 
    ```

    然而, 

    ```lua
    "10" == 10      -- 返回 false. 
    ```

10. 取字符串长度
    '#' 操作符可以用于取字符串长度.

    ```lua
    #"abcd"     -- 返回 4.
    a = "abc"
    #a          -- 返回 3.
    ```

11. array
    **注意: lua 里的数组下标是从 1 开始的!!!**
    类似于 awk 里的关联数组, 数组下标既可以是数值也可以是字符串.
    **注意: a = {key = 9} 形式赋值一个数组时, key 只能是合法的 Identify, 想要消除这个限制而采用任意的字符串, 方法就是采用中括号把那个字符串括起来.
    如: a = {["+-*/"] = 7}, 完了只能用 a["+-*/"] 形式访问, 而不能用 a.key 形式访问.**

    ```lua
    a = {x=10}              -- 等价于 
    a = {}; a["x"] = 10; 

    a.x                     -- 等价于
    a["x"]
    ```

    **注意: 数值下标无法用 a.x 的方式访问.**

    `#a` 可以获取数组 a 的长度, 但是仅限于普通从下标1 (而不是0) 开始的数组.

12. 操作符
    == 表判断相等, 而 ~= 表判断不相等,
    其他的 &lt; &gt; &lt;= &gt;= + - * / 都一样.
    == 只比较引用, 而不比较值.
    也就是说:

    ```lua
    a = {}; a.x = 1;
    b = {}; b.x = 1;
    c = a
    ```
    结果:  a == c 而 a ~= b
    字符串之间也可以互相比较, 类似于 (strcmp)

13. 逻辑运算符
    and, or, not 支持短路运算。

14. 局部变量

    ```lua
    local i = 1
    ```
    显示声明 i 为局部变量. 局部变量作用域限于一个 block. 
    而不是一个函数.
    lua 里面局部变量需要声明, 而 Python 里面全局变量需要声明.
    **注意: 没有声明 local 的话, 即为全局变量, 哪怕是在函数内部赋值的.**

15. 代码块
    do ... end 语句可以规定一个代码块, 这很有用, 当需要规定局部变量时.

16. 控制语句

    ```lua
    if condition then
        ......
    elseif condition then
        ......
    else
        ......
    end
    ```

    ```lua
    while condition do
        ......
    end
    ```

    ```lua
    repeat
        ......
    until condition
    ```

    ```lua
    for var=i, j, k do
        ......
    end
    -- 从 i 到 j 以 k 为步长, k 可省略默认为 1.
    ```

    ```lua
    for index in pairs(array) do
        ...... -- (index 为 array 中的下标)
    end
    ```

17. break 和 return
    break 用于终止循环, return 用于终止函数.
    **注意: 这两个只能用于坑爹的句末, 也就是说 end else until 之前. 如果需要再中间使用的话, 可以采用 do break end 形式.**

18. 函数

    ```lua
    object:foo(x)           -- 等价于
    object.foo(object, x)
    ```
    支持多返回值, 和并行赋值 (类似于 Python). 
    支持变长参数 (用 ... 表示和 {...} 访问) 
    如:

    ```lua
    function f(...)
        for i, v in ipairs{...} do
            ......
        end
    end
    ```

[jekyll-gh]: https://github.com/jekyll/jekyll
[jekyll]:    http://jekyllrb.com

